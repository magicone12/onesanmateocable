<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>San Mateo Cable - Pull Screen</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.compiled.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body {
  margin:0;
  background:#000;
  overflow:hidden;
  font-family:Arial,sans-serif;
}

/* VIDEO WRAPPER - DRAGGABLE */
.videoWrapper {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#000;
  transition:all 0.3s ease;
  cursor:grab;
  z-index:1000;
}

.videoWrapper.pullScreen {
  width:400px;
  height:225px; /* 16:9 */
  top:20px;
  left:20px;
  cursor:move;
}

video {
  width:100%;
  height:100%;
  object-fit:contain;
  background:#000;
  display:block;
  pointer-events:none; /* para madrag wrapper */
}

/* CHANNEL PANEL OVERLAY */
.channelPanelOverlay {
  position:fixed;
  top:0;
  right:-300px; /* hidden by default */
  width:300px;
  max-width:80%;
  height:100vh;
  background:rgba(30,30,30,0.95);
  padding:10px;
  z-index:1001;
  overflow-y:auto;
  transition:right 0.3s ease-in-out;
  box-shadow:-5px 0 15px rgba(0,0,0,0.5);
}

.channelPanelOverlay.show { right:0; }

.channelPanelOverlay h3 {
  margin:0 0 10px;
  padding:15px 0;
  text-align:center;
  background:#00e1ff;
  color:#000;
  position:sticky;
  top:0;
}

.channel {
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px;
  margin-bottom:6px;
  background:#2b2b2b;
  border-radius:6px;
  cursor:pointer;
}

.channel img { width:60px; height:36px; object-fit:contain; }
.chName { flex:1; text-align:center; }

/* PULL SCREEN TOGGLE BUTTON */
.toggleBtn {
  position:fixed;
  top:10px;
  left:10px;
  padding:8px 12px;
  background:rgba(0,0,0,0.7);
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
  z-index:1002;
}
</style>
</head>
<body>

<div class="videoWrapper" id="videoWrapper">
  <video id="video" autoplay playsinline></video>
</div>

<button class="toggleBtn" id="toggleBtn">Pull Screen</button>

<div class="channelPanelOverlay" id="channelPanel">
  <h3>SAN MATEO CABLE</h3>
  <div id="channelList"></div>
</div>

<script>
shaka.polyfill.installAll();
const video = document.getElementById("video");
const wrapper = document.getElementById("videoWrapper");
const toggleBtn = document.getElementById("toggleBtn");
const panel = document.getElementById("channelPanel");
const player = new shaka.Player(video);
let hlsPlayer=null;
let lastChannel=null;
let isPullScreen = false;

/* CHANNEL LIST */
const channels = [
  {name:"KAPAMILYA CHANNEL",logo:"https://i.imgur.com/fRETRXx.png",src:"https://cdn-ue1-prod.tsv2.amagi.tv/linear/amg01006-abs-cbn-kapcha-dash-abscbnono/54afaecb-9608-4827-a19a-e1a2d2f498d5/index.mpd",type:"mpd"},
  {name:"GOLDEN TV",logo:"https://i.imgur.com/urWAPgv.png",src:"https://long-hall-41fd.ostamark484.workers.dev",type:"hls"}
];

/* BUILD CHANNEL LIST */
function buildList(){
  const el=document.getElementById("channelList");
  el.innerHTML="";
  channels.forEach((ch,i)=>{
    const row=document.createElement("div");
    row.className="channel";
    const img=document.createElement("img"); img.src=ch.logo||"https://via.placeholder.com/60x36";
    const sp=document.createElement("span"); sp.className="chName"; sp.textContent=(i+1)+". "+ch.name;
    row.appendChild(img); row.appendChild(sp);
    row.onclick=()=>{ playChannel(ch); togglePanel(false); };
    el.appendChild(row);
  });
}
buildList();

/* TOGGLE CHANNEL PANEL */
function togglePanel(show){
  if(show) panel.classList.add("show");
  else panel.classList.remove("show");
}

/* CLICK VIDEO TO SHOW/HIDE PANEL */
wrapper.onclick = (e)=>{
  if(!isPullScreen) panel.classList.toggle("show");
}

/* PLAY CHANNEL */
async function playChannel(ch){
  if(!ch.src) return;
  lastChannel=ch;
  try{ await player.unload(); }catch(e){}
  video.muted=false;

  if(ch.type==="mpd"){
    player.load(ch.src).catch(()=>setTimeout(()=>playChannel(ch),3000));
  }
  if(ch.type==="hls"){
    if(video.canPlayType("application/vnd.apple.mpegurl")){
      video.src=ch.src; video.play().catch(()=>{});
    }else if(Hls.isSupported()){
      if(hlsPlayer) hlsPlayer.destroy();
      hlsPlayer=new Hls();
      hlsPlayer.attachMedia(video);
      hlsPlayer.loadSource(ch.src);
      hlsPlayer.on(Hls.Events.MANIFEST_PARSED,()=>video.play().catch(()=>{}));
    }
  }
}

/* PULL SCREEN TOGGLE BUTTON */
toggleBtn.onclick = ()=>{
  isPullScreen = !isPullScreen;
  if(isPullScreen){
    wrapper.classList.add("pullScreen");
    toggleBtn.textContent="Fullscreen";
  }else{
    wrapper.classList.remove("pullScreen");
    toggleBtn.textContent="Pull Screen";
    if(video.requestFullscreen) video.requestFullscreen();
  }
};

/* DRAG FUNCTIONALITY FOR PULL SCREEN */
let offsetX=0, offsetY=0, dragging=false;

wrapper.addEventListener("mousedown",(e)=>{
  if(!isPullScreen) return;
  dragging=true;
  offsetX=e.clientX - wrapper.offsetLeft;
  offsetY=e.clientY - wrapper.offsetTop;
});

document.addEventListener("mousemove",(e)=>{
  if(dragging){
    wrapper.style.left=(e.clientX - offsetX)+"px";
    wrapper.style.top=(e.clientY - offsetY)+"px";
  }
});

document.addEventListener("mouseup",()=>{ dragging=false; });

/* AUTO PLAY FIRST CHANNEL */
window.onload = async ()=>{
  playChannel(channels[0]);
  if(!isPullScreen && video.requestFullscreen){
    await video.requestFullscreen();
  }
};
</script>

</body>
</html>
